# P2P文件传输系统测试指南 (更新版)

## 准备工作

1. **确认后端服务运行**：
   ```bash
   cd /mnt/c/Users/11427/desktop/P2P/P2P
   dotnet run
   ```
   *注意*：服务器启动后，会显示本机IP地址，使用这个IP来访问服务。

2. **启动前端服务**：
   ```bash
   cd /mnt/c/Users/11427/desktop/P2P/p2p-client
   npm start
   ```

## 测试步骤 (适用于本地和远程设备)

### 1. 访问应用

有两种方式访问应用：

**方式1：本地测试**
- 在开发机上访问：http://localhost:3000

**方式2：多设备测试**
- 在其他设备上，使用开发机的IP地址访问：
- 如 `http://开发机IP:3000`
- 例如：`http://192.168.1.100:3000`

### 2. 生成邀请码测试

1. 在**设备A**上：
   - 点击"Generate New Code"按钮
   - 记录生成的邀请码（例如：ABC12345）
   - 应该自动登录到传输页面

2. 在**设备B**上：
   - 在"Enter Invitation Code"字段中输入设备A的邀请码
   - 点击"Connect"按钮
   - 应该登录到传输页面
   - 在屏幕上应看到"Connected Devices: 2/2"

### 3. 消息传输测试

1. 在**设备A**上：
   - 在消息输入框中输入"Hello from Device A"
   - 点击"Send"按钮

2. 在**设备B**上：
   - 应该看到来自设备A的消息
   - 同样输入"Hello from Device B"并发送
   - 设备A应该收到此消息

### 4. 文件传输测试

1. 在**设备A**上：
   - 点击"Select File"选择一个小文件（如文本文件或小图片）
   - 点击"Send File"按钮
   - 应该看到文件上传进度条

2. 在**设备B**上：
   - 应该看到文件接收进度条
   - 文件接收完成后，应该可以点击"Download"下载文件

## 重要变更说明

最新版本做了以下重要改进：

1. **自动IP检测**：前端应用现在会自动检测当前主机名，适应不同IP环境
2. **CORS改进**：后端CORS配置已优化，支持任何源的访问
3. **详细日志**：添加了额外的日志输出，方便排查问题

## 排错指南

如果测试中出现问题：

1. **检查后端日志**：
   - 后端运行中应显示详细日志，包括生成的邀请码和认证请求
   - 确认请求是否正确到达后端

2. **检查控制台错误**：
   - 在浏览器中按F12打开开发工具
   - 查看Console选项卡中的错误信息
   - 查看API请求是否使用了正确的URL（应该使用主机IP而非localhost）

3. **CORS问题**：
   - 确保测试设备与开发机在同一网络
   - 检查浏览器控制台是否显示CORS错误
   - 如果显示CORS错误，确认访问的是主机IP而非域名

4. **设备数量限制问题**：
   - 如果显示"Maximum number of devices"错误
   - 访问`http://[开发机IP]:5235/api/device/clear/{你的邀请码}`清除设备

## 预期结果

成功测试后，两台设备应该能够：
1. 同时登录同一账户
2. 看到对方的在线状态
3. 相互发送和接收文本消息
4. 相互发送和接收文件